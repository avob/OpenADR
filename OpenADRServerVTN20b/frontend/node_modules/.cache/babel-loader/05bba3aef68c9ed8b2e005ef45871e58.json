{"ast":null,"code":"import Swagger from 'swagger-client';\nimport * as types from '../constants/actionTypes';\nimport { config, history } from './configureStore';\nvar swaggerClient = null;\n\nvar responseInterceptor = function responseInterceptor(res) {// console.log(res);\n};\n\nvar loadClient = function loadClient(url, dispatch) {\n  return new Promise(function (resolve, reject) {\n    if (swaggerClient != null) {\n      resolve(swaggerClient);\n    } else {\n      var params = {\n        url: url,\n        responseInterceptor: responseInterceptor,\n        requestInterceptor: function requestInterceptor(req) {\n          if (config.username != null && config.password != null) {\n            var encoded = btoa(config.username + \":\" + config.password);\n            console.log(encoded);\n            req.headers[\"Authorization\"] = \"Basic \" + encoded;\n          }\n        }\n      };\n      return Swagger(params).then(function (client) {\n        config.isConnected = true;\n        config.isConnectionPending = false; // dispatch({\n        //   type: types.LOGIN_USER_SUCCESS\n        // })\n\n        swaggerClient = client;\n        resolve(client);\n      }).catch(function (err) {\n        config.isConnected = false;\n        config.isConnectionPending = false;\n        dispatch({\n          type: types.LOGIN_USER_ERROR,\n          payload: err\n        });\n        history.push(\"/login\");\n        swaggerClient = null;\n      });\n    }\n  });\n};\n\nexport default function swaggerMiddleware(opts) {\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        console.log(action.type);\n\n        if (action.type.indexOf(\"_ERROR\") > -1) {\n          console.log(action.payload);\n        }\n\n        if (!action.swagger) {\n          return next(action);\n        }\n\n        loadClient(opts.url, store.dispatch, config).then(function (client) {\n          action.swagger(client);\n        });\n      };\n    };\n  };\n}","map":{"version":3,"sources":["/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/src/store/swaggerMiddleware.js"],"names":["Swagger","types","config","history","swaggerClient","responseInterceptor","res","loadClient","url","dispatch","Promise","resolve","reject","params","requestInterceptor","req","username","password","encoded","btoa","console","log","headers","then","client","isConnected","isConnectionPending","catch","err","type","LOGIN_USER_ERROR","payload","push","swaggerMiddleware","opts","store","next","action","indexOf","swagger"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,gBAApB;AACA,OAAO,KAAKC,KAAZ,MAAuB,0BAAvB;AAEA,SAASC,MAAT,EAAiBC,OAAjB,QAAgC,kBAAhC;AAGA,IAAIC,aAAa,GAAG,IAApB;;AAEA,IAAIC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,GAAD,EAAS,CAC/B;AACD,CAFH;;AAKA,IAAIC,UAAU,GAAG,SAAbA,UAAa,CAAWC,GAAX,EAAgBC,QAAhB,EAA0B;AACzC,SAAO,IAAIC,OAAJ,CAAa,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvC,QAAKR,aAAa,IAAI,IAAtB,EAA6B;AAC3BO,MAAAA,OAAO,CAAEP,aAAF,CAAP;AAED,KAHD,MAGO;AACL,UAAIS,MAAM,GAAG;AAACL,QAAAA,GAAG,EAACA,GAAL;AAAUH,QAAAA,mBAAmB,EAAEA,mBAA/B;AACTS,QAAAA,kBAAkB,EAAE,4BAAAC,GAAG,EAAI;AAC3B,cAAGb,MAAM,CAACc,QAAP,IAAmB,IAAnB,IAA2Bd,MAAM,CAACe,QAAP,IAAmB,IAAjD,EAAuD;AACrD,gBAAIC,OAAO,GAAGC,IAAI,CAACjB,MAAM,CAACc,QAAP,GAAiB,GAAjB,GAAqBd,MAAM,CAACe,QAA7B,CAAlB;AACAG,YAAAA,OAAO,CAACC,GAAR,CAAYH,OAAZ;AACAH,YAAAA,GAAG,CAACO,OAAJ,CAAY,eAAZ,IAA+B,WAAUJ,OAAzC;AACD;AACF;AAPU,OAAb;AAUA,aAAOlB,OAAO,CAAEa,MAAF,CAAP,CAAkBU,IAAlB,CAAwB,UAAAC,MAAM,EAAI;AACvCtB,QAAAA,MAAM,CAACuB,WAAP,GAAqB,IAArB;AACAvB,QAAAA,MAAM,CAACwB,mBAAP,GAA6B,KAA7B,CAFuC,CAGvC;AACA;AACA;;AACAtB,QAAAA,aAAa,GAAGoB,MAAhB;AACAb,QAAAA,OAAO,CAAEa,MAAF,CAAP;AACD,OARM,EAQHG,KARG,CAQG,UAAAC,GAAG,EAAI;AACf1B,QAAAA,MAAM,CAACuB,WAAP,GAAqB,KAArB;AACAvB,QAAAA,MAAM,CAACwB,mBAAP,GAA6B,KAA7B;AACAjB,QAAAA,QAAQ,CAAC;AACPoB,UAAAA,IAAI,EAAE5B,KAAK,CAAC6B,gBADL;AAEPC,UAAAA,OAAO,EAAEH;AAFF,SAAD,CAAR;AAIAzB,QAAAA,OAAO,CAAC6B,IAAR,CAAa,QAAb;AACA5B,QAAAA,aAAa,GAAG,IAAhB;AACD,OAjBM,CAAP;AAkBD;AACF,GAlCM,CAAP;AAmCD,CApCD;;AAsCA,eAAe,SAAS6B,iBAAT,CAA4BC,IAA5B,EAAmC;AAChD,SAAO,UAAAC,KAAK;AAAA,WAAI,UAAAC,IAAI;AAAA,aAAI,UAAAC,MAAM,EAAI;AAEhCjB,QAAAA,OAAO,CAACC,GAAR,CAAagB,MAAM,CAACR,IAApB;;AACA,YAAGQ,MAAM,CAACR,IAAP,CAAYS,OAAZ,CAAoB,QAApB,IAAgC,CAAC,CAApC,EAAsC;AACpClB,UAAAA,OAAO,CAACC,GAAR,CAAYgB,MAAM,CAACN,OAAnB;AACD;;AAED,YAAK,CAACM,MAAM,CAACE,OAAb,EAAuB;AACrB,iBAAOH,IAAI,CAAEC,MAAF,CAAX;AACD;;AAED9B,QAAAA,UAAU,CAAE2B,IAAI,CAAC1B,GAAP,EAAY2B,KAAK,CAAC1B,QAAlB,EAA4BP,MAA5B,CAAV,CACGqB,IADH,CACS,UAACC,MAAD,EAAY;AACjBa,UAAAA,MAAM,CAACE,OAAP,CAAgBf,MAAhB;AACD,SAHH;AAMD,OAjBmB;AAAA,KAAR;AAAA,GAAZ;AAkBD","sourcesContent":["import Swagger from 'swagger-client';\nimport * as types from '../constants/actionTypes';\n\nimport { config, history } from './configureStore';\n\n\nvar swaggerClient = null;\n\nvar responseInterceptor=  (res) => {\n    // console.log(res);\n  }\n\n\nvar loadClient = function ( url, dispatch) {\n  return new Promise( (resolve, reject) => {\n    if ( swaggerClient != null ) {\n      resolve( swaggerClient );\n\n    } else {\n      var params = {url:url, responseInterceptor: responseInterceptor\n        , requestInterceptor: req => {\n          if(config.username != null && config.password != null) {\n            var encoded = btoa(config.username +\":\"+config.password);\n            console.log(encoded)\n            req.headers[\"Authorization\"] = \"Basic \"+ encoded\n          }\n        }};\n\n      \n      return Swagger( params ).then( client => {\n        config.isConnected = true\n        config.isConnectionPending = false\n        // dispatch({\n        //   type: types.LOGIN_USER_SUCCESS\n        // })\n        swaggerClient = client; \n        resolve( client );\n      } ).catch(err => {\n        config.isConnected = false\n        config.isConnectionPending = false\n        dispatch({\n          type: types.LOGIN_USER_ERROR,\n          payload: err\n        });\n        history.push(\"/login\")\n        swaggerClient = null;\n      });\n    }\n  } );\n}\n\nexport default function swaggerMiddleware( opts ) {\n  return store => next => action => {\n    \n    console.log( action.type )\n    if(action.type.indexOf(\"_ERROR\") > -1){\n      console.log(action.payload)\n    }\n\n    if ( !action.swagger ) {\n      return next( action );\n    }\n\n    loadClient( opts.url, store.dispatch, config )\n      .then( (client) => {\n        action.swagger( client );\n      } )\n\n\n  }\n}\n"]},"metadata":{},"sourceType":"module"}