{"ast":null,"code":"import _classCallCheck from \"/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/src/components/EventCreate/EventCreate.js\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Paper from '@material-ui/core/Paper';\nimport EventCreateDescriptorStep from './EventCreateDescriptorStep';\nimport EventCreateActivePeriodStep from './EventCreateActivePeriodStep';\nimport EventCreateEventSignalStep from './EventCreateEventSignalStep';\nimport EventCreateEventTarget from './EventCreateEventTarget';\nimport EventCreateConfirmationStep from './EventCreateConfirmationStep';\nimport { minutesToICalDuration } from '../../utils/time';\n\nfunction getSteps() {\n  return ['Descriptor', 'Active Period', 'Signal', 'Targets', 'Confirmation'];\n}\n\nexport var EventCreate =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(EventCreate, _React$Component);\n\n  function EventCreate(props) {\n    var _this;\n\n    _classCallCheck(this, EventCreate);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EventCreate).call(this, props));\n\n    _this.handleFinish = function () {\n      _this.handleCreateEvent();\n    };\n\n    _this.handleNext = function () {\n      var activeStep = _this.state.activeStep;\n\n      if (activeStep === getSteps().length - 1) {\n        _this.handleFinish();\n      } else {\n        _this.setState({\n          activeStep: activeStep + 1\n        });\n      }\n    };\n\n    _this.handleBack = function () {\n      _this.setState(function (state) {\n        return {\n          activeStep: state.activeStep - 1\n        };\n      });\n    };\n\n    _this.handleReset = function () {\n      _this.setState({\n        activeStep: 0\n      });\n    };\n\n    _this.handleCreateEvent = function (needPublish) {\n      var addXMLDurationIfNotNull = function addXMLDurationIfNotNull(src, field, value) {\n        if (value != null) {\n          src[field] = minutesToICalDuration(value);\n        }\n      };\n\n      var activePeriod = {\n        start: _this.state.activePeriod.start,\n        duration: minutesToICalDuration(_this.state.activePeriod.duration)\n      };\n      addXMLDurationIfNotNull(activePeriod, \"rampUpDuration\", _this.state.activePeriod.rampUpDuration);\n      addXMLDurationIfNotNull(activePeriod, \"recoveryDuration\", _this.state.activePeriod.recoveryDuration);\n      addXMLDurationIfNotNull(activePeriod, \"toleranceDuration\", _this.state.activePeriod.toleranceDuration);\n      addXMLDurationIfNotNull(activePeriod, \"notificationDuration\", _this.state.activePeriod.notificationDuration);\n      var dto = {\n        published: needPublish,\n        descriptor: {\n          marketContext: _this.state.descriptor.marketContext,\n          priority: _this.state.descriptor.priority,\n          responseRequired: _this.state.descriptor.responseRequired,\n          testEvent: _this.state.descriptor.testEvent,\n          state: \"ACTIVE\",\n          oadrProfile: _this.state.descriptor.oadrProfile\n        },\n        activePeriod: activePeriod,\n        signals: _this.state.eventSignal,\n        targets: _this.state.eventTarget\n      };\n\n      _this.props.createEvent(dto);\n    };\n\n    _this.handleDescriptorChange = function (descriptor) {\n      _this.setState(descriptor);\n    };\n\n    _this.handleActivePeriodChange = function (activePeriod) {\n      _this.setState(activePeriod);\n    };\n\n    _this.handleEventSignalChange = function (eventSignal) {\n      _this.setState(eventSignal);\n    };\n\n    _this.handleEventTargetChange = function (eventTarget) {\n      _this.setState(eventTarget);\n    };\n\n    _this.createEvent = function () {};\n\n    var now = new Date();\n    _this.state = {\n      activeStep: 0,\n      descriptor: {\n        // eventName: \"\",\n        // timezone: \"UTC\",\n        // priority:0,\n        // responseRequired:\"always\",\n        // testEvent: false,\n        // vtnComment: \"\",\n        // vtnComment: \"\",\n        // marketContext: null\n        oadrProfile: \"OADR20B\",\n        priority: 0,\n        responseRequired: \"ALWAYS\",\n        testEvent: false,\n        vtnComment: \"\",\n        marketContext: \"http://MarketContext1\"\n      },\n      activePeriod: {\n        // start: null,\n        // duration: \"\",\n        timezone: \"UTC\",\n        start: now.getTime(),\n        duration: 120,\n        notificationDuration: 120,\n        rampUpDuration: 120,\n        toleranceDuration: 120,\n        recoveryDuration: 120\n      },\n      eventSignal: [{\n        // signalName: \"\",\n        // signalType: \"\",\n        // unitType: \"\",\n        // signalInterval: [],\n        // currentValue: \"\",\n        intervals: [],\n        currentValue: \"97.5\",\n        signalName: \"ENERGY_PRICE\",\n        signalType: \"price\",\n        unitType: \"euro_per_kwh\"\n      }],\n      // eventTarget: []\n      eventTarget: [{\n        targetType: \"ven\",\n        targetId: \"4A:D1:2E:95:49:43:80:0B:8D:E9\"\n      }]\n    };\n    return _this;\n  }\n\n  _createClass(EventCreate, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          classes = _this$props.classes,\n          marketContext = _this$props.marketContext,\n          group = _this$props.group,\n          ven = _this$props.ven;\n      var steps = getSteps();\n      var _this$state = this.state,\n          activeStep = _this$state.activeStep,\n          descriptor = _this$state.descriptor,\n          activePeriod = _this$state.activePeriod,\n          eventSignal = _this$state.eventSignal,\n          eventTarget = _this$state.eventTarget,\n          hasError = _this$state.hasError;\n      var that = this;\n\n      var getStepContent = function getStepContent(step) {\n        switch (step) {\n          case 0:\n            return React.createElement(EventCreateDescriptorStep, {\n              classes: classes,\n              marketContext: marketContext,\n              descriptor: descriptor,\n              onChange: _this2.handleDescriptorChange,\n              hasError: hasError,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 189\n              },\n              __self: this\n            });\n\n          case 1:\n            return React.createElement(EventCreateActivePeriodStep, {\n              classes: classes,\n              marketContext: marketContext,\n              activePeriod: activePeriod,\n              onChange: _this2.handleActivePeriodChange,\n              hasError: hasError,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 192\n              },\n              __self: this\n            });\n\n          case 2:\n            return React.createElement(EventCreateEventSignalStep, {\n              classes: classes,\n              onChange: _this2.handleEventSignalChange,\n              eventSignal: eventSignal,\n              hasError: hasError,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 195\n              },\n              __self: this\n            });\n\n          case 3:\n            return React.createElement(EventCreateEventTarget, {\n              classes: classes,\n              group: group,\n              eventTarget: eventTarget,\n              onChange: _this2.handleEventTargetChange,\n              ven: ven,\n              onVenSuggestionsFetchRequested: _this2.props.onVenSuggestionsFetchRequested,\n              onVenSuggestionsClearRequested: _this2.props.onVenSuggestionsClearRequested,\n              onVenSuggestionsSelect: _this2.props.onVenSuggestionsSelect,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 198\n              },\n              __self: this\n            });\n\n          case 4:\n            return React.createElement(EventCreateConfirmationStep, {\n              classes: classes,\n              group: group,\n              marketContext: marketContext,\n              descriptor: descriptor,\n              eventTarget: eventTarget,\n              eventSignal: eventSignal,\n              createEvent: _this2.createEvent,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 205\n              },\n              __self: this\n            });\n\n          default:\n            return 'Unknown step';\n        }\n      };\n\n      function getSetValidation(step) {\n        switch (step) {\n          case 0:\n            return descriptor.priority != null && descriptor.marketContext != null && descriptor.eventName != \"\";\n\n          case 1:\n            return activePeriod.start != null && activePeriod.duration != \"\";\n\n          case 2:\n            var valid = false;\n\n            for (var i in eventSignal) {\n              if (eventSignal[i].signalName == \"\" || eventSignal[i].signalType == \"\" || eventSignal[i].currentValue == \"\" && eventSignal[i].signalInterval.length == 0) {\n                return false;\n              }\n            }\n\n            return true;\n\n          case 3:\n            return eventTarget.length > 0;\n\n          case 4:\n            return true;\n\n          default:\n            return false;\n        }\n      }\n\n      function handleValidatedNext(step) {\n        return function (e) {\n          if (getSetValidation(step)) {\n            if (that.state.hasError) {\n              that.setState({\n                hasError: false\n              });\n            }\n\n            that.handleNext(e);\n          } else {\n            that.setState({\n              hasError: true\n            });\n          }\n        };\n      }\n\n      return React.createElement(\"div\", {\n        className: classes.root,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      }, React.createElement(Stepper, {\n        activeStep: activeStep,\n        className: classes.stepper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }, steps.map(function (label, index) {\n        var props = {};\n        var labelProps = {};\n        props.completed = false;\n        return React.createElement(Step, Object.assign({\n          key: label\n        }, props, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 273\n          },\n          __self: this\n        }), React.createElement(StepLabel, Object.assign({}, labelProps, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 274\n          },\n          __self: this\n        }), label));\n      })), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281\n        },\n        __self: this\n      }, activeStep === steps.length ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283\n        },\n        __self: this\n      }, React.createElement(Typography, {\n        className: classes.instructions,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 284\n        },\n        __self: this\n      }, \"All steps completed - you're finished\"), React.createElement(Button, {\n        onClick: this.handleReset,\n        className: classes.button,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287\n        },\n        __self: this\n      }, \"Reset\")) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293\n        },\n        __self: this\n      }, React.createElement(Button, {\n        disabled: activeStep === 0,\n        onClick: this.handleBack,\n        className: classes.button,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294\n        },\n        __self: this\n      }, \"Back\"), React.createElement(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: handleValidatedNext(activeStep),\n        className: classes.button,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299\n        },\n        __self: this\n      }, activeStep === steps.length - 1 ? 'Create Event' : 'Next'), activeStep === steps.length - 1 ? React.createElement(Button, {\n        variant: \"contained\",\n        color: \"secondary\",\n        onClick: function onClick() {\n          that.handleCreateEvent(true);\n        },\n        className: classes.button,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 305\n        },\n        __self: this\n      }, \"Create And Publish Event\") : null), React.createElement(Typography, {\n        component: \"div\",\n        className: classes.instructions,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312\n        },\n        __self: this\n      }, React.createElement(Paper, {\n        elevation: 1,\n        style: {\n          padding: '20px 0px'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 313\n        },\n        __self: this\n      }, getStepContent(activeStep))))));\n    }\n  }]);\n\n  return EventCreate;\n}(React.Component);\nexport default EventCreate;","map":{"version":3,"sources":["/home/bzanni/Documents/github/OpenADR/OpenADRServerVTN20b/frontend/src/components/EventCreate/EventCreate.js"],"names":["React","PropTypes","withStyles","Stepper","Step","StepLabel","Button","Typography","FormControl","FormLabel","Select","MenuItem","Paper","EventCreateDescriptorStep","EventCreateActivePeriodStep","EventCreateEventSignalStep","EventCreateEventTarget","EventCreateConfirmationStep","minutesToICalDuration","getSteps","EventCreate","props","handleFinish","handleCreateEvent","handleNext","activeStep","state","length","setState","handleBack","handleReset","needPublish","addXMLDurationIfNotNull","src","field","value","activePeriod","start","duration","rampUpDuration","recoveryDuration","toleranceDuration","notificationDuration","dto","published","descriptor","marketContext","priority","responseRequired","testEvent","oadrProfile","signals","eventSignal","targets","eventTarget","createEvent","handleDescriptorChange","handleActivePeriodChange","handleEventSignalChange","handleEventTargetChange","now","Date","vtnComment","timezone","getTime","intervals","currentValue","signalName","signalType","unitType","targetType","targetId","classes","group","ven","steps","hasError","that","getStepContent","step","onVenSuggestionsFetchRequested","onVenSuggestionsClearRequested","onVenSuggestionsSelect","getSetValidation","eventName","valid","i","signalInterval","handleValidatedNext","e","root","stepper","map","label","index","labelProps","completed","instructions","button","padding","Component"],"mappings":";;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,UAAT,QAA2B,0BAA3B;AAGA,OAAOC,OAAP,MAAoB,2BAApB;AACA,OAAOC,IAAP,MAAiB,wBAAjB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,UAAP,MAAuB,8BAAvB;AAEA,OAAOC,WAAP,MAAwB,+BAAxB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,QAAP,MAAqB,4BAArB;AAGA,OAAOC,KAAP,MAAkB,yBAAlB;AAEA,OAAOC,yBAAP,MAAsC,6BAAtC;AACA,OAAOC,2BAAP,MAAwC,+BAAxC;AACA,OAAOC,0BAAP,MAAuC,8BAAvC;AACA,OAAOC,sBAAP,MAAmC,0BAAnC;AACA,OAAOC,2BAAP,MAAwC,+BAAxC;AAEA,SAAQC,qBAAR,QAAoC,kBAApC;;AAMA,SAASC,QAAT,GAAoB;AAClB,SAAO,CAAE,YAAF,EAAgB,eAAhB,EAAiC,QAAjC,EAA2C,SAA3C,EAAsD,cAAtD,CAAP;AACD;;AAGD,WAAaC,WAAb;AAAA;AAAA;AAAA;;AACE,uBAAaC,KAAb,EAAqB;AAAA;;AAAA;;AACnB,qFAAOA,KAAP;;AADmB,UAoDrBC,YApDqB,GAoDN,YAAM;AACnB,YAAKC,iBAAL;AACD,KAtDoB;;AAAA,UAwDrBC,UAxDqB,GAwDR,YAAM;AAAA,UACVC,UADU,GACI,MAAKC,KADT,CACVD,UADU;;AAEjB,UAAKA,UAAU,KAAKN,QAAQ,GAAGQ,MAAX,GAAoB,CAAxC,EAA4C;AAC1C,cAAKL,YAAL;AACD,OAFD,MAEO;AACL,cAAKM,QAAL,CAAe;AACbH,UAAAA,UAAU,EAAEA,UAAU,GAAG;AADZ,SAAf;AAGD;AAEF,KAlEoB;;AAAA,UAoErBI,UApEqB,GAoER,YAAM;AACjB,YAAKD,QAAL,CAAe,UAAAF,KAAK;AAAA,eAAK;AACvBD,UAAAA,UAAU,EAAEC,KAAK,CAACD,UAAN,GAAmB;AADR,SAAL;AAAA,OAApB;AAGD,KAxEoB;;AAAA,UA0ErBK,WA1EqB,GA0EP,YAAM;AAClB,YAAKF,QAAL,CAAe;AACbH,QAAAA,UAAU,EAAE;AADC,OAAf;AAGD,KA9EoB;;AAAA,UAkFrBF,iBAlFqB,GAkFD,UAACQ,WAAD,EAAiB;AACnC,UAAIC,uBAAuB,GAAG,SAA1BA,uBAA0B,CAACC,GAAD,EAAMC,KAAN,EAAaC,KAAb,EAAuB;AACnD,YAAGA,KAAK,IAAI,IAAZ,EAAiB;AACfF,UAAAA,GAAG,CAACC,KAAD,CAAH,GAAahB,qBAAqB,CAACiB,KAAD,CAAlC;AACD;AACF,OAJD;;AAKA,UAAIC,YAAY,GAAG;AACjBC,QAAAA,KAAK,EAAE,MAAKX,KAAL,CAAWU,YAAX,CAAwBC,KADd;AAEjBC,QAAAA,QAAQ,EAAEpB,qBAAqB,CAAC,MAAKQ,KAAL,CAAWU,YAAX,CAAwBE,QAAzB;AAFd,OAAnB;AAIAN,MAAAA,uBAAuB,CAACI,YAAD,EAAe,gBAAf,EAAiC,MAAKV,KAAL,CAAWU,YAAX,CAAwBG,cAAzD,CAAvB;AACAP,MAAAA,uBAAuB,CAACI,YAAD,EAAe,kBAAf,EAAmC,MAAKV,KAAL,CAAWU,YAAX,CAAwBI,gBAA3D,CAAvB;AACAR,MAAAA,uBAAuB,CAACI,YAAD,EAAe,mBAAf,EAAoC,MAAKV,KAAL,CAAWU,YAAX,CAAwBK,iBAA5D,CAAvB;AACAT,MAAAA,uBAAuB,CAACI,YAAD,EAAe,sBAAf,EAAuC,MAAKV,KAAL,CAAWU,YAAX,CAAwBM,oBAA/D,CAAvB;AAEA,UAAIC,GAAG,GAAG;AAGRC,QAAAA,SAAS,EAAEb,WAHH;AAIRc,QAAAA,UAAU,EAAE;AACVC,UAAAA,aAAa,EAAE,MAAKpB,KAAL,CAAWmB,UAAX,CAAsBC,aAD3B;AAEVC,UAAAA,QAAQ,EAAE,MAAKrB,KAAL,CAAWmB,UAAX,CAAsBE,QAFtB;AAGVC,UAAAA,gBAAgB,EAAE,MAAKtB,KAAL,CAAWmB,UAAX,CAAsBG,gBAH9B;AAIVC,UAAAA,SAAS,EAAE,MAAKvB,KAAL,CAAWmB,UAAX,CAAsBI,SAJvB;AAKVvB,UAAAA,KAAK,EAAE,QALG;AAMVwB,UAAAA,WAAW,EAAE,MAAKxB,KAAL,CAAWmB,UAAX,CAAsBK;AANzB,SAJJ;AAaRd,QAAAA,YAAY,EAAEA,YAbN;AAeRe,QAAAA,OAAO,EAAE,MAAKzB,KAAL,CAAW0B,WAfZ;AAiBRC,QAAAA,OAAO,EAAE,MAAK3B,KAAL,CAAW4B;AAjBZ,OAAV;;AAmBA,YAAKjC,KAAL,CAAWkC,WAAX,CAAwBZ,GAAxB;AACD,KArHoB;;AAAA,UAuHrBa,sBAvHqB,GAuHI,UAACX,UAAD,EAAgB;AACvC,YAAKjB,QAAL,CAAciB,UAAd;AACD,KAzHoB;;AAAA,UA2HrBY,wBA3HqB,GA2HM,UAACrB,YAAD,EAAkB;AAC3C,YAAKR,QAAL,CAAcQ,YAAd;AACD,KA7HoB;;AAAA,UA+HrBsB,uBA/HqB,GA+HK,UAACN,WAAD,EAAiB;AACzC,YAAKxB,QAAL,CAAcwB,WAAd;AACD,KAjIoB;;AAAA,UAmIrBO,uBAnIqB,GAmIK,UAACL,WAAD,EAAiB;AACzC,YAAK1B,QAAL,CAAc0B,WAAd;AACD,KArIoB;;AAAA,UAuIrBC,WAvIqB,GAuIP,YAAM,CAEnB,CAzIoB;;AAEnB,QAAIK,GAAG,GAAG,IAAIC,IAAJ,EAAV;AACA,UAAKnC,KAAL,GAAa;AACXD,MAAAA,UAAU,EAAE,CADD;AAEXoB,MAAAA,UAAU,EAAE;AACV;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACAK,QAAAA,WAAW,EAAE,SAVH;AAWVH,QAAAA,QAAQ,EAAC,CAXC;AAYVC,QAAAA,gBAAgB,EAAC,QAZP;AAaVC,QAAAA,SAAS,EAAE,KAbD;AAcVa,QAAAA,UAAU,EAAE,EAdF;AAeVhB,QAAAA,aAAa,EAAE;AAfL,OAFD;AAmBXV,MAAAA,YAAY,EAAE;AACZ;AACA;AACA2B,QAAAA,QAAQ,EAAE,KAHE;AAIZ1B,QAAAA,KAAK,EAAEuB,GAAG,CAACI,OAAJ,EAJK;AAKZ1B,QAAAA,QAAQ,EAAE,GALE;AAMZI,QAAAA,oBAAoB,EAAE,GANV;AAOZH,QAAAA,cAAc,EAAE,GAPJ;AAQZE,QAAAA,iBAAiB,EAAE,GARP;AASZD,QAAAA,gBAAgB,EAAE;AATN,OAnBH;AA8BXY,MAAAA,WAAW,EAAE,CAAC;AACZ;AACA;AACA;AACA;AACA;AAEAa,QAAAA,SAAS,EAAE,EAPC;AAQZC,QAAAA,YAAY,EAAE,MARF;AASZC,QAAAA,UAAU,EAAE,cATA;AAUZC,QAAAA,UAAU,EAAE,OAVA;AAWZC,QAAAA,QAAQ,EAAE;AAXE,OAAD,CA9BF;AA4CX;AACAf,MAAAA,WAAW,EAAE,CAAC;AAACgB,QAAAA,UAAU,EAAC,KAAZ;AAAmBC,QAAAA,QAAQ,EAAC;AAA5B,OAAD;AA7CF,KAAb;AAHmB;AAkDpB;;AAnDH;AAAA;AAAA,6BA8IW;AAAA;;AAAA,wBACsC,KAAKlD,KAD3C;AAAA,UACAmD,OADA,eACAA,OADA;AAAA,UACS1B,aADT,eACSA,aADT;AAAA,UACwB2B,KADxB,eACwBA,KADxB;AAAA,UAC+BC,GAD/B,eAC+BA,GAD/B;AAEP,UAAMC,KAAK,GAAGxD,QAAQ,EAAtB;AAFO,wBAG4E,KAAKO,KAHjF;AAAA,UAGAD,UAHA,eAGAA,UAHA;AAAA,UAGYoB,UAHZ,eAGYA,UAHZ;AAAA,UAGwBT,YAHxB,eAGwBA,YAHxB;AAAA,UAGsCgB,WAHtC,eAGsCA,WAHtC;AAAA,UAGmDE,WAHnD,eAGmDA,WAHnD;AAAA,UAGgEsB,QAHhE,eAGgEA,QAHhE;AAIP,UAAIC,IAAI,GAAG,IAAX;;AAGA,UAAIC,cAAc,GAAG,SAAjBA,cAAiB,CAAEC,IAAF,EAAY;AAC/B,gBAAQA,IAAR;AACE,eAAK,CAAL;AACE,mBAAO,oBAAC,yBAAD;AAA2B,cAAA,OAAO,EAAEP,OAApC;AAA6C,cAAA,aAAa,EAAE1B,aAA5D;AACL,cAAA,UAAU,EAAED,UADP;AACmB,cAAA,QAAQ,EAAE,MAAI,CAACW,sBADlC;AAC0D,cAAA,QAAQ,EAAEoB,QADpE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;;AAEF,eAAK,CAAL;AACE,mBAAO,oBAAC,2BAAD;AAA6B,cAAA,OAAO,EAAEJ,OAAtC;AAA+C,cAAA,aAAa,EAAE1B,aAA9D;AACL,cAAA,YAAY,EAAEV,YADT;AACuB,cAAA,QAAQ,EAAE,MAAI,CAACqB,wBADtC;AACgE,cAAA,QAAQ,EAAEmB,QAD1E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;;AAEF,eAAK,CAAL;AACE,mBAAO,oBAAC,0BAAD;AAA4B,cAAA,OAAO,EAAEJ,OAArC;AAA8C,cAAA,QAAQ,EAAE,MAAI,CAACd,uBAA7D;AACL,cAAA,WAAW,EAAEN,WADR;AACqB,cAAA,QAAQ,EAAEwB,QAD/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;;AAEF,eAAK,CAAL;AACE,mBAAO,oBAAC,sBAAD;AAAwB,cAAA,OAAO,EAAEJ,OAAjC;AAA0C,cAAA,KAAK,EAAEC,KAAjD;AAAwD,cAAA,WAAW,EAAEnB,WAArE;AACL,cAAA,QAAQ,EAAE,MAAI,CAACK,uBADV;AAEL,cAAA,GAAG,EAAEe,GAFA;AAGL,cAAA,8BAA8B,EAAE,MAAI,CAACrD,KAAL,CAAW2D,8BAHtC;AAIL,cAAA,8BAA8B,EAAE,MAAI,CAAC3D,KAAL,CAAW4D,8BAJtC;AAKL,cAAA,sBAAsB,EAAE,MAAI,CAAC5D,KAAL,CAAW6D,sBAL9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;;AAMF,eAAK,CAAL;AACE,mBAAO,oBAAC,2BAAD;AAA6B,cAAA,OAAO,EAAEV,OAAtC;AAA+C,cAAA,KAAK,EAAEC,KAAtD;AAA6D,cAAA,aAAa,EAAE3B,aAA5E;AACL,cAAA,UAAU,EAAED,UADP;AACmB,cAAA,WAAW,EAAES,WADhC;AAC6C,cAAA,WAAW,EAAEF,WAD1D;AACuE,cAAA,WAAW,EAAE,MAAI,CAACG,WADzF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;;AAEF;AACE,mBAAO,cAAP;AArBJ;AAuBD,OAxBD;;AA4BA,eAAS4B,gBAAT,CAA2BJ,IAA3B,EAAkC;AAChC,gBAAQA,IAAR;AACE,eAAK,CAAL;AACE,mBAAOlC,UAAU,CAACE,QAAX,IAAuB,IAAvB,IACFF,UAAU,CAACC,aAAX,IAA4B,IAD1B,IAEFD,UAAU,CAACuC,SAAX,IAAwB,EAF7B;;AAIF,eAAK,CAAL;AACE,mBAAOhD,YAAY,CAACC,KAAb,IAAsB,IAAtB,IACFD,YAAY,CAACE,QAAb,IAAyB,EAD9B;;AAGF,eAAK,CAAL;AACE,gBAAI+C,KAAK,GAAG,KAAZ;;AAEA,iBAAI,IAAIC,CAAR,IAAalC,WAAb,EAAyB;AACvB,kBAAIA,WAAW,CAACkC,CAAD,CAAX,CAAenB,UAAf,IAA6B,EAA7B,IACCf,WAAW,CAACkC,CAAD,CAAX,CAAelB,UAAf,IAA6B,EAD9B,IAEEhB,WAAW,CAACkC,CAAD,CAAX,CAAepB,YAAf,IAA+B,EAA/B,IACDd,WAAW,CAACkC,CAAD,CAAX,CAAeC,cAAf,CAA8B5D,MAA9B,IAAwC,CAH7C,EAGiD;AAC/C,uBAAO,KAAP;AACD;AACF;;AACD,mBAAO,IAAP;;AAGF,eAAK,CAAL;AACE,mBAAO2B,WAAW,CAAC3B,MAAZ,GAAqB,CAA5B;;AACF,eAAK,CAAL;AACE,mBAAO,IAAP;;AACF;AACE,mBAAO,KAAP;AA7BJ;AA+BD;;AAED,eAAS6D,mBAAT,CAA8BT,IAA9B,EAAqC;AACnC,eAAO,UAACU,CAAD,EAAO;AACZ,cAAKN,gBAAgB,CAAEJ,IAAF,CAArB,EAAgC;AAC9B,gBAAKF,IAAI,CAACnD,KAAL,CAAWkD,QAAhB,EAA2B;AACzBC,cAAAA,IAAI,CAACjD,QAAL,CAAe;AACbgD,gBAAAA,QAAQ,EAAE;AADG,eAAf;AAGD;;AACDC,YAAAA,IAAI,CAACrD,UAAL,CAAiBiE,CAAjB;AACD,WAPD,MAOO;AACLZ,YAAAA,IAAI,CAACjD,QAAL,CAAe;AACbgD,cAAAA,QAAQ,EAAE;AADG,aAAf;AAGD;AACF,SAbD;AAcD;;AAED,aACA;AAAK,QAAA,SAAS,EAAGJ,OAAO,CAACkB,IAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,OAAD;AAAS,QAAA,UAAU,EAAGjE,UAAtB;AAAmC,QAAA,SAAS,EAAG+C,OAAO,CAACmB,OAAvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACIhB,KAAK,CAACiB,GAAN,CAAW,UAACC,KAAD,EAAQC,KAAR,EAAkB;AAC3B,YAAMzE,KAAK,GAAG,EAAd;AACA,YAAM0E,UAAU,GAAG,EAAnB;AACA1E,QAAAA,KAAK,CAAC2E,SAAN,GAAkB,KAAlB;AACA,eACA,oBAAC,IAAD;AAAM,UAAA,GAAG,EAAGH;AAAZ,WAAwBxE,KAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YACE,oBAAC,SAAD,oBAAe0E,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YACIF,KADJ,CADF,CADA;AAOD,OAXD,CADJ,CADF,EAeE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACIpE,UAAU,KAAKkD,KAAK,CAAChD,MAArB,GACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,UAAD;AAAY,QAAA,SAAS,EAAG6C,OAAO,CAACyB,YAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iDADF,EAIE,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAG,KAAKnE,WAAvB;AAAqC,QAAA,SAAS,EAAG0C,OAAO,CAAC0B,MAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAJF,CADF,GAUE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,MAAD;AAAQ,QAAA,QAAQ,EAAGzE,UAAU,KAAK,CAAlC;AACQ,QAAA,OAAO,EAAG,KAAKI,UADvB;AAEQ,QAAA,SAAS,EAAG2C,OAAO,CAAC0B,MAF5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,EAME,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAC,WAAhB;AACQ,QAAA,KAAK,EAAC,SADd;AAEQ,QAAA,OAAO,EAAGV,mBAAmB,CAAE/D,UAAF,CAFrC;AAGQ,QAAA,SAAS,EAAG+C,OAAO,CAAC0B,MAH5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAIIzE,UAAU,KAAKkD,KAAK,CAAChD,MAAN,GAAe,CAA9B,GAAkC,cAAlC,GAAmD,MAJvD,CANF,EAYIF,UAAU,KAAKkD,KAAK,CAAChD,MAAN,GAAe,CAA9B,GAAkC,oBAAC,MAAD;AAAQ,QAAA,OAAO,EAAC,WAAhB;AAC5B,QAAA,KAAK,EAAC,WADsB;AAE5B,QAAA,OAAO,EAAG,mBAAM;AAAEkD,UAAAA,IAAI,CAACtD,iBAAL,CAAuB,IAAvB;AAA8B,SAFpB;AAG5B,QAAA,SAAS,EAAGiD,OAAO,CAAC0B,MAHQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCAAlC,GAKU,IAjBd,CADF,EAoBE,oBAAC,UAAD;AAAY,QAAA,SAAS,EAAC,KAAtB;AAA4B,QAAA,SAAS,EAAG1B,OAAO,CAACyB,YAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,KAAD;AAAO,QAAA,SAAS,EAAG,CAAnB;AAAuB,QAAA,KAAK,EAAG;AAAEE,UAAAA,OAAO,EAAE;AAAX,SAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACIrB,cAAc,CAAErD,UAAF,CADlB,CADF,CApBF,CAXN,CAfF,CADA;AA0DD;AA9RH;;AAAA;AAAA,EAAiCzB,KAAK,CAACoG,SAAvC;AAiSA,eAAehF,WAAf","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\n\n\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\n\nimport FormControl from '@material-ui/core/FormControl';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\n\n\nimport Paper from '@material-ui/core/Paper';\n\nimport EventCreateDescriptorStep from './EventCreateDescriptorStep'\nimport EventCreateActivePeriodStep from './EventCreateActivePeriodStep'\nimport EventCreateEventSignalStep from './EventCreateEventSignalStep'\nimport EventCreateEventTarget from './EventCreateEventTarget'\nimport EventCreateConfirmationStep from './EventCreateConfirmationStep'\n\nimport {minutesToICalDuration} from '../../utils/time'\n\n\n\n\n\nfunction getSteps() {\n  return [ 'Descriptor', 'Active Period', 'Signal', 'Targets', 'Confirmation' ];\n}\n\n\nexport class EventCreate extends React.Component {\n  constructor( props ) {\n    super( props );\n    var now = new Date()\n    this.state = {\n      activeStep: 0,\n      descriptor: {\n        // eventName: \"\",\n        // timezone: \"UTC\",\n        // priority:0,\n        // responseRequired:\"always\",\n        // testEvent: false,\n        // vtnComment: \"\",\n       \n        // vtnComment: \"\",\n        // marketContext: null\n        oadrProfile: \"OADR20B\",\n        priority:0,\n        responseRequired:\"ALWAYS\",\n        testEvent: false,\n        vtnComment: \"\",\n        marketContext: \"http://MarketContext1\"\n      },\n      activePeriod: {\n        // start: null,\n        // duration: \"\",\n        timezone: \"UTC\",\n        start: now.getTime(),\n        duration: 120,\n        notificationDuration: 120,\n        rampUpDuration: 120,\n        toleranceDuration: 120,\n        recoveryDuration: 120,\n      },\n      eventSignal: [{\n        // signalName: \"\",\n        // signalType: \"\",\n        // unitType: \"\",\n        // signalInterval: [],\n        // currentValue: \"\",\n     \n        intervals: [],\n        currentValue: \"97.5\",\n        signalName: \"ENERGY_PRICE\",\n        signalType: \"price\",\n        unitType: \"euro_per_kwh\",\n        \n      }],\n      // eventTarget: []\n      eventTarget: [{targetType:\"ven\", targetId:\"4A:D1:2E:95:49:43:80:0B:8D:E9\"}]\n    };\n  }\n\n  handleFinish = () => {\n    this.handleCreateEvent();\n  }\n\n  handleNext = () => {\n    const {activeStep} = this.state;\n    if ( activeStep === getSteps().length - 1 ) {\n      this.handleFinish();\n    } else {\n      this.setState( {\n        activeStep: activeStep + 1,\n      } );\n    }\n\n  };\n\n  handleBack = () => {\n    this.setState( state => ({\n      activeStep: state.activeStep - 1,\n    }) );\n  };\n\n  handleReset = () => {\n    this.setState( {\n      activeStep: 0,\n    } );\n  };\n\n \n\n  handleCreateEvent = (needPublish) => {\n    var addXMLDurationIfNotNull = (src, field, value) => {\n      if(value != null){\n        src[field] = minutesToICalDuration(value);\n      }\n    }\n    var activePeriod = {\n      start: this.state.activePeriod.start,\n      duration: minutesToICalDuration(this.state.activePeriod.duration)\n    }\n    addXMLDurationIfNotNull(activePeriod, \"rampUpDuration\", this.state.activePeriod.rampUpDuration);\n    addXMLDurationIfNotNull(activePeriod, \"recoveryDuration\", this.state.activePeriod.recoveryDuration);\n    addXMLDurationIfNotNull(activePeriod, \"toleranceDuration\", this.state.activePeriod.toleranceDuration);\n    addXMLDurationIfNotNull(activePeriod, \"notificationDuration\", this.state.activePeriod.notificationDuration);\n\n    var dto = {\n     \n      \n      published: needPublish,\n      descriptor: {\n        marketContext: this.state.descriptor.marketContext,\n        priority: this.state.descriptor.priority,\n        responseRequired: this.state.descriptor.responseRequired,\n        testEvent: this.state.descriptor.testEvent,\n        state: \"ACTIVE\" ,\n        oadrProfile: this.state.descriptor.oadrProfile,\n      },\n\n      activePeriod: activePeriod,\n\n      signals: this.state.eventSignal,\n\n      targets: this.state.eventTarget\n    }\n    this.props.createEvent( dto );\n  }\n\n  handleDescriptorChange = (descriptor) => {\n    this.setState(descriptor);\n  }\n\n  handleActivePeriodChange = (activePeriod) => {\n    this.setState(activePeriod);\n  }\n\n  handleEventSignalChange = (eventSignal) => {\n    this.setState(eventSignal);\n  }\n\n  handleEventTargetChange = (eventTarget) => {\n    this.setState(eventTarget);\n  }\n\n  createEvent = () => {\n\n  } \n\n  \n\n  render() {\n    const {classes, marketContext, group, ven} = this.props;\n    const steps = getSteps();\n    const {activeStep, descriptor, activePeriod, eventSignal, eventTarget, hasError} = this.state;\n    var that = this;\n\n\n    var getStepContent = ( step ) => {\n      switch (step) {\n        case 0:\n          return <EventCreateDescriptorStep classes={classes} marketContext={marketContext} \n            descriptor={descriptor} onChange={this.handleDescriptorChange} hasError={hasError}/>\n        case 1:\n          return <EventCreateActivePeriodStep classes={classes} marketContext={marketContext} \n            activePeriod={activePeriod} onChange={this.handleActivePeriodChange} hasError={hasError}/>\n        case 2:\n          return <EventCreateEventSignalStep classes={classes} onChange={this.handleEventSignalChange}\n            eventSignal={eventSignal} hasError={hasError}/>\n        case 3:\n          return <EventCreateEventTarget classes={classes} group={group} eventTarget={eventTarget} \n            onChange={this.handleEventTargetChange}\n            ven={ven}\n            onVenSuggestionsFetchRequested={this.props.onVenSuggestionsFetchRequested}\n            onVenSuggestionsClearRequested={this.props.onVenSuggestionsClearRequested}\n            onVenSuggestionsSelect={this.props.onVenSuggestionsSelect}/>\n        case 4:\n          return <EventCreateConfirmationStep classes={classes} group={group} marketContext={marketContext} \n            descriptor={descriptor} eventTarget={eventTarget} eventSignal={eventSignal} createEvent={this.createEvent}/>\n        default:\n          return 'Unknown step';\n      }\n    }\n\n    \n\n    function getSetValidation( step ) {\n      switch (step) {\n        case 0:\n          return descriptor.priority != null\n            && descriptor.marketContext != null\n            && descriptor.eventName != \"\";\n\n        case 1:\n          return activePeriod.start != null \n            && activePeriod.duration != \"\";\n\n        case 2:\n          var valid = false;\n\n          for(var i in eventSignal){\n            if( eventSignal[i].signalName == \"\" \n              || eventSignal[i].signalType == \"\" \n              || (eventSignal[i].currentValue == \"\" \n              && eventSignal[i].signalInterval.length == 0 )){\n              return false;\n            }\n          }\n          return true;\n          \n            \n        case 3:\n          return eventTarget.length > 0;\n        case 4:\n          return true;\n        default:\n          return false\n      }\n    }\n\n    function handleValidatedNext( step ) {\n      return (e) => {\n        if ( getSetValidation( step ) ) {\n          if ( that.state.hasError ) {\n            that.setState( {\n              hasError: false\n            } );\n          }\n          that.handleNext( e );\n        } else {\n          that.setState( {\n            hasError: true\n          } );\n        }\n      }\n    }\n\n    return (\n    <div className={ classes.root }>\n      <Stepper activeStep={ activeStep } className={ classes.stepper }>\n        { steps.map( (label, index) => {\n            const props = {};\n            const labelProps = {};\n            props.completed = false;\n            return (\n            <Step key={ label } {...props}>\n              <StepLabel {...labelProps}>\n                { label }\n              </StepLabel>\n            </Step>\n            );\n          } ) }\n      </Stepper>\n      <div>\n        { activeStep === steps.length ? (\n            <div>\n              <Typography className={ classes.instructions }>\n                All steps completed - you&apos;re finished\n              </Typography>\n              <Button onClick={ this.handleReset } className={ classes.button }>\n                Reset\n              </Button>\n            </div>\n            ) : (\n            <div>\n              <div>\n                <Button disabled={ activeStep === 0 }\n                        onClick={ this.handleBack }\n                        className={ classes.button }>\n                  Back\n                </Button>\n                <Button variant=\"contained\"\n                        color=\"primary\"\n                        onClick={ handleValidatedNext( activeStep )}\n                        className={ classes.button }>\n                  { activeStep === steps.length - 1 ? 'Create Event' : 'Next' }\n                </Button>\n                { activeStep === steps.length - 1 ? <Button variant=\"contained\"\n                        color=\"secondary\"\n                        onClick={ () => { that.handleCreateEvent(true) } }\n                        className={ classes.button }>\n                    Create And Publish Event\n                </Button> : null }\n              </div>\n              <Typography component=\"div\" className={ classes.instructions }>\n                <Paper elevation={ 1 } style={ { padding: '20px 0px' } }>\n                  { getStepContent( activeStep ) }\n                </Paper>\n              </Typography>\n              \n            </div>\n            ) }\n      </div>\n    </div>\n    );\n  }\n}\n\nexport default EventCreate;\n"]},"metadata":{},"sourceType":"module"}